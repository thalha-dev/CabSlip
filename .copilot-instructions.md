# CabSlip Android App - Copilot Instructions

## Project Overview
CabSlip is a native Android application built for cab/taxi drivers to generate digital receipts for their trips. The app allows drivers to create, edit, and share professional PDF receipts with customers.

## Tech Stack & Architecture
- **Language**: Kotlin
- **UI Framework**: Jetpack Compose (Material 3)
- **Architecture**: MVVM with Repository pattern
- **Database**: Room (SQLite)
- **Navigation**: Jetpack Navigation Compose
- **PDF Generation**: Custom PDF generation utility
- **Minimum SDK**: 29 (Android 10)
- **Target SDK**: 36
- **Compile SDK**: 36

## Project Structure
```
app/src/main/java/dev/thalha/cabslip/
├── MainActivity.kt                          # Entry point
├── data/
│   ├── database/CabSlipDatabase.kt         # Room database setup
│   ├── dao/                                # Data Access Objects
│   ├── entity/                             # Database entities (CabInfo, Receipt)
│   └── repository/CabSlipRepository.kt     # Data repository layer
├── ui/
│   ├── components/                         # Reusable UI components
│   │   ├── SignatureCapture.kt            # Digital signature component
│   │   └── LogoUpload.kt                  # Logo upload component
│   ├── navigation/CabSlipNavigation.kt    # Navigation setup
│   ├── screens/                           # All app screens
│   │   ├── FirstTimeSetupScreen.kt        # Onboarding
│   │   ├── HomeScreen.kt                  # Dashboard
│   │   ├── CabInfoScreen.kt               # Driver info management
│   │   ├── CreateReceiptScreen.kt         # New receipt creation
│   │   ├── EditReceiptScreen.kt           # Receipt editing
│   │   └── ReceiptsScreen.kt              # Receipt listing
│   └── theme/                             # Material 3 theming
└── utils/                                 # Utility classes
    ├── PdfGenerator.kt                    # PDF creation utility
    ├── ShareUtils.kt                      # Sharing functionality
    └── ReceiptIdGenerator.kt              # Unique ID generation
```

## Core Features

### 1. Driver Information Management
- **Setup Screen**: First-time setup for driver details
- **Cab Info Screen**: Manage driver name, mobile, company, logo
- **Logo Upload**: Image picker and storage for company logos
- **Validation**: Required fields validation

### 2. Receipt Management
- **Create Receipt**: Comprehensive trip receipt creation
- **Edit Receipt**: Full editing capabilities with delete functionality
- **List Receipts**: View all created receipts with search/filter
- **Delete Receipts**: Delete with confirmation dialog

### 3. Trip Details Capture
- **Locations**: Boarding location and destination
- **Date/Time**: Trip start/end with date/time pickers
- **Fare Calculation**: 
  - Base fare (Price per KM × Total KM)
  - Waiting charges (Rate per hour × Hours)
  - Additional charges (Toll, Parking, Bata)
  - Auto-calculated totals
- **Driver Details**: Name, mobile, vehicle number
- **Digital Signature**: Customer signature capture

### 4. PDF Generation & Sharing
- **Professional PDFs**: Generate formatted receipt PDFs
- **Share Functionality**: Share PDFs via various apps
- **Receipt ID**: Auto-generated unique receipt IDs

## Database Schema

### CabInfo Entity
- `id`: Primary key
- `driverName`: Driver's name
- `driverMobile`: Contact number
- `companyName`: Cab company name
- `logoPath`: Company logo file path
- `createdAt`, `updatedAt`: Timestamps

### Receipt Entity
- `receiptId`: Unique receipt identifier (Primary key)
- `boardingLocation`, `destination`: Trip locations
- `tripStartDate`, `tripEndDate`: Trip timestamps
- `pricePerKm`, `totalKm`: Fare calculation base
- `waitingChargePerHr`, `waitingHrs`: Waiting charges
- `tollParking`, `bata`: Additional charges
- `driverName`, `driverMobile`, `vehicleNumber`: Driver details
- `ownerSignaturePath`: Customer signature file path
- `baseFare`, `waitingFee`, `totalFee`: Calculated amounts
- `createdAt`, `updatedAt`: Timestamps

## Key UI Components

### SignatureCapture
- Canvas-based signature drawing
- Save/clear functionality
- File system storage
- Edit mode support for existing signatures

### Date/Time Pickers
- Material 3 DatePicker and TimePicker
- Separate date and time selection
- Combined date-time storage

### Navigation Structure
- Bottom navigation: Home, Receipts, Create
- Screen navigation with proper state management
- Back navigation handling

## Important Implementation Details

### 1. Material 3 Usage
- Using stable Material 3 APIs
- Some experimental APIs may require `@OptIn(ExperimentalMaterial3Api::class)`
- Proper color schemes and theming

### 2. File Storage
- Signatures stored in app's private storage
- Logo images handled through file picker
- Proper file path management

### 3. PDF Generation
- Custom PDF generation without external libraries
- Professional receipt formatting
- Includes all trip details and signatures

### 4. Navigation Issues Fixed
- Proper bottom navigation selection states
- Clickable areas expanded beyond icons
- State management for navigation

### 5. Validation & Error Handling
- Required field validation
- Numeric field validation
- User-friendly error messages
- Loading states for async operations

## Recent Enhancements
1. **Delete Functionality**: Added delete button with confirmation dialog in EditReceiptScreen
2. **Date/Time UI**: Separated date and time fields for better UX
3. **Navigation UX**: Improved bottom navigation clickability and state management
4. **Signature Component**: Enhanced signature capture with edit mode support

## Development Guidelines

### Code Style
- Follow Kotlin conventions
- Use Jetpack Compose best practices
- Implement proper state management
- Add comprehensive error handling

### UI/UX Patterns
- Material 3 design system
- Consistent spacing and typography
- Loading states for all async operations
- Confirmation dialogs for destructive actions

### Testing Considerations
- Room database testing
- Repository layer testing
- UI component testing with Compose
- PDF generation validation

### Performance Considerations
- Efficient database queries
- Proper image handling and compression
- Memory management for signatures
- Lazy loading for receipt lists

## Common Issues & Solutions

### 1. Navigation Problems
- Use proper navigation state management
- Handle back stack correctly
- Ensure proper destination IDs

### 2. Date/Time Handling
- Use proper date formatters
- Handle timezone considerations
- Validate date ranges

### 3. File Storage
- Check storage permissions
- Handle file not found scenarios
- Clean up temporary files

### 4. PDF Generation
- Ensure all required data is present
- Handle large signature files
- Validate PDF creation success

## Future Enhancement Ideas
- Receipt templates
- Cloud backup/sync
- Analytics and reporting
- Multi-language support
- Customer management
- Trip history analytics
- Expense tracking
- Integration with payment systems

## Package Information
- **Package Name**: `dev.thalha.cabslip`
- **Version**: 1.0 (versionCode: 1)
- **Minimum Android Version**: Android 10 (API 29)
- **Target Android Version**: Android 14+ (API 36)

This project represents a complete, production-ready Android application with modern architecture patterns and comprehensive functionality for cab receipt management.
